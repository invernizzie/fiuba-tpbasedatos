\documentclass[12pt,a4paper,spanish]{article} 
\usepackage{babel}
\usepackage [T1]{fontenc}
\usepackage [latin1]{inputenc}
\usepackage{graphicx} 
\usepackage{verbatim}
\usepackage{array}
	  \oddsidemargin 0in
      \textwidth 6.75in
      \topmargin 0in
      \textheight 10.0in
      \parindent 0em
      \parskip 2ex
\usepackage{anysize}
\marginsize{3cm}{2cm}{1.0cm}{1.0cm}

\pagestyle{plain}

\begin{document} 
\title{
\begin{table}[!h]
	\begin{tabular}{m{2cm}m{15cm}}
		\multicolumn{1}{l}{} &
		% \includegraphics[scale=0.5, bb=0 0 0 0]{logo-fiuba.PNG} & 
		 \begin{center}
		 	\begin{LARGE}
				Universidad de Buenos Aires	\linebreak \linebreak		 							Facultad de Ingenier\'{i}a  \linebreak \linebreak
				7515 - Base de Datos \linebreak \linebreak
				1er. Cuatrimestre de 2010
			\end{LARGE}
		 \end{center}\\
\end{tabular}
\end{table}
\begin{Large}
 \begin{center}
		\underline{TP Base de Datos: SIGeek} \linebreak \linebreak
        Docente a cargo: Ing. Lucas Roman
\end{center}
\end{Large}
}
\date{}
\maketitle

\thispagestyle{empty}
\author{
\begin{Large}
\begin{center}
		\underline{Integrantes}  \linebreak 
\end{center}
\end{Large}
\begin{center}
	\begin{tabular}{|| c | c | c ||}
		\hline
		\begin{large}Apellido y Nombre\end{large} & 
		\begin{large}Padr\'{o}n Nro.\end{large} & 
		\begin{large}E-mail\end{large}\\
		\hline
		Bruno Tomás & 88.449 & tbruno88@gmail.com\\
		\hline
		Invernizzi Esteban Ignacio & 88.817 & invernizzie@gmail.com\\
		\hline
		Meller Gustavo Ariel  & 88.435 & gmeller@gmail.com\\
		\hline
		Rivero Hern\'an Javier & 88.455 & riverohernanj@gmail.com\\
		\hline
	\end{tabular}
\end{center}
}

\newpage
\setcounter{page}{1} 
\tableofcontents
\newpage

\section{Introducción}

	Esta segunda entrega consta de la resolución y la expresión en lenguaje SQL de once consultas, contra un esquema relacional propuesto por la cátedra. Las sentencias y cláusulas a utilizar fueron restringidas a las presentadas por la cátedra en la cartilla del apunte del lenguaje SQL.

\section{Consultas y resolución}
	
	\begin{itemize}
	
		\item[Consulta 1] El promedio de mothers pedidas por pedido.\\
		
		\begin{verbatim}

		SELECT sum(CANT_PEDIDA) / (count(distinct PEDIDO.NRO_PEDIDO) * count(distinct PEDIDO.NRO_PEDIDO)) PROMEDIO
		FROM PEDIDO, ITEM_PEDIDO, SUBTIPO_COMPONENTE
		WHERE ITEM_PEDIDO.SUBTIPO = SUBTIPO_COMPONENTE.SUBTIPO
		AND TIPO = 'MOTHER'

  		\end{verbatim}

		Hipótesis: Hay pedido de mothers.		

		\begin{verbatim}		

		SELECT SUM(CANT_PEDIDA) / COUNT ( DISTINCT NRO_PEDIDO) PROMEDIO
		FROM (	
			SELECT NRO_PEDIDO, SUBTIPO ,CANT_PEDIDA
			FROM ITEM_PEDIDO
			UNION (
					SELECT NRO_PEDIDO, I.SUBTIPO,  -CANT_PEDIDA
					FROM ITEM_PEDIDO I, SUBTIPO_COMPONENTE S
					WHERE I.SUBTIPO = S.SUBTIPO AND TIPO <> 'MOTHER'))
					
		\end{verbatim}
		
		\paragraph{Resultado}
		PROMEDIO
		2,25

		\item[Consulta 2] La razón social de los proveedores tales que existe un producto
que no comercializan.\\
		
		\begin{verbatim}

		SELECT RAZON_SOCIAL
		FROM PROVEEDOR pr1
		WHERE EXISTS (	
		SELECT * 
		FROM TIPO_COMPONENTE
		WHERE NOT EXISTS(
			SELECT * 
		    FROM CATALOGO_PROVEEDOR, SUBTIPO_COMPONENTE
    	    WHERE CATALOGO_PROVEEDOR.SUBTIPO = SUBTIPO_COMPONENTE.SUBTIPO
        	AND pr1.CUIT = CATALOGO_PROVEEDOR.CUIT
	       	AND SUBTIPO_COMPONENTE.TIPO = TIPO_COMPONENTE.TIPO) )
		
		\end{verbatim}
		
		\paragraph{Resultado}	   
		RAZON_SOCIAL
		Intcomex Argentina S.A.
		Ceven S.A.
		Solution Box S.R.L.
		
		\item[Consulta 3] Un listado alfabético de subtipos de componentes a reponer indicando tipo de componente, subtipo de componente y razon$\_$social de los proveedores que los comercializan.\\
		
		\begin{verbatim}

		SELECT TIPO,  S.SUBTIPO, RAZON_SOCIAL
		FROM SUBTIPO_COMPONENTE S, CATALOGO_PROVEEDOR C, PROVEEDOR P
		WHERE S.SUBTIPO = C.SUBTIPO 
		AND C.CUIT = P. CUIT 
		AND CANT_STOCK < CANT_MINIMA
		ORDER BY TIPO, SUBTIPO

		\end{verbatim}
		
		\paragraph{Resultado}	   
		TIPO	SUBTIPO	RAZON_SOCIAL
		HDD	WD WD1001FALS	Distecna S.A.
		HDD	WD WD1001FALS	Ceven S.A.
		HDD	WD WD2001FASS	Distecna S.A.
		HDD	WD WD2001FASS	Ceven S.A.
		MEMORIA RAM	KINGSTON DD3 1066 4GB	Ceven S.A.
		MEMORIA RAM	KINGSTON DD3 1066 4GB	Distecna S.A.
		MOTHER	GIGABYTE GA-H55M-UD2H	Distecna S.A.
		MOTHER	GIGABYTE GA-H55M-UD2H	Intcomex Argentina S.A.
		PLACAS VIDEO	XFX ATI 4860 1GB DDR5	Solution Box S.R.L.
		PLACAS VIDEO	XFX ATI 4860 1GB DDR5	Distecna S.A.
		PLACAS VIDEO	XFX ATI 4860 1GB DDR5	Ceven S.A.
		PLACAS VIDEO	XFX ATI 5700 1GB DDR5	Solution Box S.R.L.
		PLACAS VIDEO	XFX ATI 5700 1GB DDR5	Intcomex Argentina S.A.
		PLACAS VIDEO	XFX ATI 5700 1GB DDR5	Distecna S.A.
		
		\item[Consulta 4] La razon$\_$social de los proveedores que comercializan todos los subtipos de componentes a reponer.
		\begin{verbatim}
		
		SELECT RAZON_SOCIAL
		FROM PROVEEDOR P
		WHERE NOT EXISTS (
			SELECT 'SUBTIPO A REPONER NO COMECIALIZADO'
			FROM SUBTIPO_COMPONENTE S	
			WHERE CANT_STOCK < CANT_MINIMA AND NOT EXISTS(
				SELECT 'SUBTIPO EN CATALOGO'
				FROM CATALOGO_PROVEEDOR C
				WHERE P.CUIT = C.CUIT AND S.SUBTIPO = C.SUBTIPO))

		\end{verbatim}
		
		\paragraph{Resultado}   
		RAZON_SOCIAL
		Distecna S.A.
		
		\item[Consulta 5] La razon$\_$social, el nro$\_$pedido y el subtipo de componente de los ítems de pedidos de subtipos de componente no comercializados por el proveedor del pedido.
		
		\begin{verbatim}
		
		SELECT RAZON_SOCIAL, PE.NRO_PEDIDO, SUBTIPO
		FROM PROVEEDOR PR, PEDIDO PE, ITEM_PEDIDO I
		WHERE PR.CUIT = PE.CUIT AND PE.NRO_PEDIDO = I.NRO_PEDIDO
		AND I.SUBTIPO NOT IN (
			SELECT SUBTIPO
			FROM CATALOGO_PROVEEDOR C
			WHERE C.CUIT = PR. CUIT) 

		\end{verbatim}
		
		\paragraph{Resultado}
		Vacío.
		
		\item[Consulta 6] La razon$\_$social de los proveedores que comercializan exclusivamente un tipo de componente.

		Lo que entiendo: La razon social de los proveedores que tienen en su catalogo un tipo de componente que no esta en el catalogo de ningún otro proveedor.
		
		\begin{verbatim}
	
		SELECT P.RAZON_SOCIAL
		FROM PROVEEDOR P, CATALOGO_PROVEEDOR CP, SUBTIPO_COMPONENTE S
		WHERE P.CUIT = CP.CUIT
		AND CP.SUBTIPO = S.SUBTIPO
		AND NOT EXISTS(
				SELECT *
				FROM PROVEEDOR P2, CATALOGO_PROVEEDOR CP2, SUBTIPO_COMPONENTE S2
				WHERE P2.CUIT = CP2.CUIT
				AND CP2.SUBTIPO = S2.SUBTIPO
				AND P.CUIT <> P2.CUIT
				AND S.TIPO = S2.TIPO)
		
		\end{verbatim}

		\paragraph{Resultado}
		RAZON_SOCIAL
		Distecna S.A.		

		\item[Consulta 7] El subtipo de los componentes entregados exclusivamente por el proveedor 'Ceven S.A.'.
		
		Hipótesis: Lo entregado se encuentra en ITEM_PEDIDO y tiene cantidad recibida mayor a cero.
		
		\begin{verbatim}		
		SELECT SUBTIPO
		FROM SUBTIPO_COMPONENTE S
		WHERE EXISTS (
			SELECT 'ENTREGA DE CEVEN S.A.'
			FROM ITEM_PEDIDO I1, PEDIDO PE1, PROVEEDOR PR1
			WHERE S.SUBTIPO = I1.SUBTIPO AND PE1.NRO_PEDIDO = I1.NRO_PEDIDO AND PR1.CUIT = PE1.CUIT
			AND CANT_RECIBIDA > 0 AND RAZON_SOCIAL='Ceven S.A.')
		AND NOT EXISTS (
			SELECT 'ENTREGA DE CEVEN S.A.'
			FROM ITEM_PEDIDO I2, PEDIDO PE2, PROVEEDOR PR2
			WHERE S.SUBTIPO = I2.SUBTIPO AND PE2.NRO_PEDIDO = I2.NRO_PEDIDO AND PR2.CUIT = PE2.CUIT
			AND CANT_RECIBIDA > 0 AND RAZON_SOCIAL<>'Ceven S.A.')
		\end{verbatim}

		\paragraph{Resultado}
		SUBTIPO
		WD WD5001AALS
		KINGSTON DD3 1066 2GB
		WD WD2001FASS
		WD WD6401AALS
		WD WD1001FALS
		XFX ATI 4860 1GB DDR5
		KINGSTON DD3 1066 1GB	
		
		\item[Consulta 8] El subtipo de los componentes para los cuales el stock informado es distinto del real.
		
		Hipotesis: los componentes que existen, no son utilizados en pcs y no estan reservadas para ordenes, forman parte del stock.
		
		\begin{verbatim}

		SELECT SUB.SUBTIPO
		FROM SUBTIPO_COMPONENTE SUB
		WHERE NOT SUB.CANT_STOCK=(
			SELECT count(*)
			FROM COMPONENTE COMP
			WHERE SUB.SUBTIPO=COMP.SUBTIPO
			and  COMP.CODIGO_PC IS NULL
			and  COMP.NRO_ORDEN IS NULL)
						
		\end{verbatim}
		
		\paragraph{Resultado}
		SUBTIPO
		GIGABYTE GA-H55M-UD2H
		INTEL I7-920
		KINGSTON DD3 1066 1GB
		KINGSTON DD3 1066 4GB
		SAMSUNG 58X SATAII
		WD WD5001AALS
		WD WD6401AALS
		XFX ATI 5700 1GB DDR5
		
		\item[Consulta 9] El nro$\_$pedido y el subtipo de componentes de los ítems de pedidos cuya cantidad pedida supere a la cantidad pedida promedio de ese subtipo de componentes.
		
		\begin{verbatim}
		
		SELECT ITEM.NRO_PEDIDO, ITEM.SUBTIPO
		FROM ITEM_PEDIDO ITEM
		WHERE ITEM.CANT_PEDIDA>( 
			SELECT avg(ITEM2.CANT_PEDIDA)
			FROM ITEM_PEDIDO ITEM2
			WHERE ITEM2.SUBTIPO=ITEM.SUBTIPO)
				   
		\end{verbatim}
		
		\paragraph{Resultado}
		NRO_PEDIDO	SUBTIPO
		1	KINGSTON DD3 1066 4GB
		4	KINGSTON DD3 1066 1GB
		4	KINGSTON DD3 1066 2GB
		4	WD WD5001AALS
		5	INTEL I7-920
		7	GIGABYTE GA-H55M-UD2H
		
		\item[Consulta 10] Para cada tipo de componente el subtipo de componente que tenga la mayor cantidad recibida.
		
		\begin{verbatim}
		
		SELECT TIPO, S1.SUBTIPO
		FROM SUBTIPO_COMPONENTE S1, ITEM_PEDIDO I1
		WHERE S1.SUBTIPO = I1.SUBTIPO
		GROUP BY TIPO,  S1.SUBTIPO
		HAVING SUM (CANT_RECIBIDA) >= ALL (
			SELECT SUM(CANT_RECIBIDA)
			FROM  SUBTIPO_COMPONENTE S2, ITEM_PEDIDO I2
			WHERE S2.SUBTIPO = I2.SUBTIPO AND S2.TIPO = S1.TIPO
			GROUP BY S2.SUBTIPO)
		ORDER BY TIPO

		\end{verbatim}		
		
		\paragraph{Resultado}
		TIPO	SUBTIPO
		CPU	INTEL I5-540M
		DVD-RW	SAMSUNG 58X SATAII
		HDD	WD WD5001AALS
		MEMORIA RAM	KINGSTON DD3 1066 1GB
		MOTHER	GIGABYTE GA-EX58-UD4P
		MOTHER	GIGABYTE GA-H55M-UD2H
		PLACAS VIDEO	XFX ATI 5700 1GB DDR5
		
		
		
		\item[Consulta 11] El subtipo de los componentes entregados por todos los proveedores que comercializan todos los tipos de componentes.
		
		\begin{verbatim}
		
		SELECT SUBTIPO
		FROM SUBTIPO_COMPONENTE S1
		WHERE NOT EXISTS(
			SELECT 'PROVEDOR DE TODOS LOS TIPOS QUE NO LO ENTREGA'
			FROM PROVEEDOR PR
			WHERE NOT EXISTS(
				SELECT 'TIPO NO ENTREGADO'
				FROM TIPO_COMPONENTE T
				WHERE NOT EXISTS (
					SELECT 'TIPO EN CATALOGO'
					FROM SUBTIPO_COMPONENTE S2, CATALOGO_PROVEEDOR C
					WHERE S2.TIPO = T.TIPO AND C.CUIT = PR.CUIT AND C.SUBTIPO =S2.SUBTIPO))
			AND PR.CUIT NOT IN (
				SELECT PE.CUIT
				FROM ITEM_PEDIDO I, PEDIDO PE
				WHERE I.NRO_PEDIDO=PE.NRO_PEDIDO AND S1.SUBTIPO = I.SUBTIPO AND CANT_RECIBIDA > 0))

		\end{verbatim}
		
		\paragraph{Resultado}
		SUBTIPO
		GIGABYTE GA-EX58-UD4P
		INTEL I7-920
		KINGSTON DD3 1066 4GB
		SAMSUNG 58X SATAII
		
	\end{itemize}

   

\end{document}
